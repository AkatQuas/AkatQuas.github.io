function InputStream(e){var n=0,r=1,t=0;return{next:function(){var a=e.charAt(n++);"\n"==a?(r++,t=0):t++;return a},peek:a,eof:function(){return""==a()},croak:function(e){throw new Error(e+" ("+r+":"+t+")")}};function a(){return e.charAt(n)}}function TokenStream(e){var n=null;return{next:function(){var e=n;return n=null,e||c()},peek:l,eof:function(){return null==l()},croak:e.croak};function r(e){return/[0-9]/i.test(e)}function t(e){return/[a-z\u03bb_]/i.test(e)}function a(e){return t(e)||"?!-<>=0123456789".indexOf(e)>=0}function u(e){return"+-*/%=&|<>!".indexOf(e)>=0}function o(e){return" \t\n".indexOf(e)>=0}function i(n){for(var r="";!e.eof()&&n(e.peek());)r+=e.next();return r}function f(n){var r=!1,t="";for(e.next();!e.eof();){var a=e.next();if(r)t+=a,r=!1;else if("\\"==a)r=!0;else{if(a==n)break;t+=a}}return t}function c(){if(i(o),e.eof())return null;var n,l,s,v,p=e.peek();return"#"==p?(i((function(e){return"\n"!=e})),e.next(),c()):'"'==p?{type:"str",value:f('"')}:r(p)?(n=!1,l=i((function(e){return"."==e?!n&&(n=!0,!0):r(e)})),{type:"num",value:parseFloat(l)}):t(p)?(v=i(a),{type:(s=v," if then else lambda \u03bb true false ".indexOf(" "+s+" ")>=0?"kw":"var"),value:v}):function(e){return",;(){}[]".indexOf(e)>=0}(p)?{type:"punc",value:e.next()}:u(p)?{type:"op",value:i(u)}:void e.croak("Can't handle character: "+p)}function l(){return n||(n=c())}}function parse(e){var n={"=":1,"||":2,"&&":3,"<":7,">":7,"<=":7,">=":7,"==":7,"!=":7,"+":10,"-":10,"*":20,"/":20,"%":20},r={type:"bool",value:!1};return function(){var n=[];for(;!e.eof();)n.push(p()),e.eof()||o(";");return{type:"prog",prog:n}}();function t(n){var r=e.peek();return r&&"punc"==r.type&&(!n||r.value==n)&&r}function a(n){var r=e.peek();return r&&"kw"==r.type&&(!n||r.value==n)&&r}function u(n){var r=e.peek();return r&&"op"==r.type&&(!n||r.value==n)&&r}function o(n){t(n)?e.next():e.croak('Expecting punctuation: "'+n+'"')}function i(n){a(n)?e.next():e.croak('Expecting keyword: "'+n+'"')}function f(r,t){var a=u();if(a){var o=n[a.value];if(o>t)return e.next(),f({type:"="==a.value?"assign":"binary",operator:a.value,left:r,right:f(v(),o)},t)}return r}function c(n,r,a,u){var i=[],f=!0;for(o(n);!e.eof()&&!t(r)&&(f?f=!1:o(a),!t(r));)i.push(u());return o(r),i}function l(){var n=e.next();return"var"!=n.type&&e.croak("Expecting variable name"),n.value}function s(e){return e=e(),t("(")?{type:"call",func:e,args:c("(",")",",",p)}:e}function v(){return s((function(){if(t("(")){e.next();var n=p();return o(")"),n}if(t("{"))return 0==(u=c("{","}",";",p)).length?r:1==u.length?u[0]:{type:"prog",prog:u};var u;if(a("if"))return function(){i("if");var n=p();t("{")||i("then");var r={type:"if",cond:n,then:p()};return a("else")&&(e.next(),r.else=p()),r}();if(a("true")||a("false"))return{type:"bool",value:"true"==e.next().value};if(a("lambda")||a("\u03bb"))return e.next(),{type:"lambda",vars:c("(",")",",",l),body:p()};var f=e.next();if("var"==f.type||"num"==f.type||"str"==f.type)return f;e.croak("Unexpected token: "+JSON.stringify(e.peek()))}))}function p(){return s((function(){return f(v(),0)}))}}function Environment(e){this.vars=Object.create(e?e.vars:null),this.parent=e}function evaluate(e,n){switch(e.type){case"num":case"str":case"bool":return e.value;case"var":return n.get(e.value);case"assign":if("var"!=e.left.type)throw new Error("Cannot assign to "+JSON.stringify(e.left));return n.set(e.left.value,evaluate(e.right,n));case"binary":return apply_op(e.operator,evaluate(e.left,n),evaluate(e.right,n));case"lambda":return make_lambda(n,e);case"if":return!1!==evaluate(e.cond,n)?evaluate(e.then,n):!!e.else&&evaluate(e.else,n);case"prog":var r=!1;return e.prog.forEach((function(e){r=evaluate(e,n)})),r;case"call":return evaluate(e.func,n).apply(null,e.args.map((function(e){return evaluate(e,n)})));default:throw new Error("I don't know how to evaluate "+e.type)}}function apply_op(e,n,r){function t(e){if("number"!=typeof e)throw new Error("Expected number but got "+e);return e}function a(e){if(0==t(e))throw new Error("Divide by zero");return e}switch(e){case"+":return t(n)+t(r);case"-":return t(n)-t(r);case"*":return t(n)*t(r);case"/":return t(n)/a(r);case"%":return t(n)%a(r);case"&&":return!1!==n&&r;case"||":return!1!==n?n:r;case"<":return t(n)<t(r);case">":return t(n)>t(r);case"<=":return t(n)<=t(r);case">=":return t(n)>=t(r);case"==":return n===r;case"!=":return n!==r}throw new Error("Can't apply operator "+e)}function make_lambda(e,n){return function(){for(var r=n.vars,t=e.extend(),a=0;a<r.length;++a)t.def(r[a],a<arguments.length&&arguments[a]);return evaluate(n.body,t)}}Environment.prototype={extend:function(){return new Environment(this)},lookup:function(e){for(var n=this;n;){if(Object.prototype.hasOwnProperty.call(n.vars,e))return n;n=n.parent}},get:function(e){if(e in this.vars)return this.vars[e];throw new Error("Undefined variable "+e)},set:function(e,n){var r=this.lookup(e);if(!r&&this.parent)throw new Error("Undefined variable "+e);return(r||this).vars[e]=n},def:function(e,n){return this.vars[e]=n}};var globalEnv=new Environment;globalEnv.def("time",(function(e){try{return console.time("time"),e()}finally{console.timeEnd("time")}})),"undefined"!=typeof process&&function(){globalEnv.def("println",(function(e){console.log(e)})),globalEnv.def("print",(function(e){console.log(e)}));var e="";process.stdin.setEncoding("utf8"),process.stdin.on("readable",(function(){var n=process.stdin.read();n&&(e+=n)})),process.stdin.on("end",(function(){evaluate(parse(TokenStream(InputStream(e))),globalEnv)}))}();