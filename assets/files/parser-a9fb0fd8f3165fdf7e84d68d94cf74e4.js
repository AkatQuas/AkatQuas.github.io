var FALSE={type:"bool",value:!1};function parse(e){var n={"=":1,"||":2,"&&":3,"<":7,">":7,"<=":7,">=":7,"==":7,"!=":7,"+":10,"-":10,"*":20,"/":20,"%":20};return function(){var n=[];for(;!e.eof();)n.push(l()),e.eof()||a(";");return{type:"prog",prog:n}}();function r(n){var r=e.peek();return r&&"punc"==r.type&&(!n||r.value==n)&&r}function t(n){var r=e.peek();return r&&"kw"==r.type&&(!n||r.value==n)&&r}function u(n){var r=e.peek();return r&&"op"==r.type&&(!n||r.value==n)&&r}function a(n){r(n)?e.next():e.croak('Expecting punctuation: "'+n+'"')}function o(n){t(n)?e.next():e.croak('Expecting keyword: "'+n+'"')}function i(r,t){var a=u();if(a){var o=n[a.value];if(o>t)return e.next(),i({type:"="==a.value?"assign":"binary",operator:a.value,left:r,right:i(v(),o)},t)}return r}function f(n,t,u,o){var i=[],f=!0;for(a(n);!e.eof()&&!r(t)&&(f?f=!1:a(u),!r(t));)i.push(o());return a(t),i}function p(){var n=e.next();return"var"!=n.type&&e.croak("Expecting variable name"),n.value}function c(e){return e=e(),r("(")?{type:"call",func:e,args:f("(",")",",",l)}:e}function v(){return c((function(){if(r("(")){e.next();var n=l();return a(")"),n}if(r("{"))return 0==(u=f("{","}",";",l)).length?FALSE:1==u.length?u[0]:{type:"prog",prog:u};var u;if(t("if"))return function(){o("if");var n=l();r("{")||o("then");var u={type:"if",cond:n,then:l()};return t("else")&&(e.next(),u.else=l()),u}();if(t("true")||t("false"))return{type:"bool",value:"true"==e.next().value};if(t("lambda")||t("\u03bb"))return e.next(),{type:"lambda",vars:f("(",")",",",p),body:l()};var i=e.next();if("var"==i.type||"num"==i.type||"str"==i.type)return i;e.croak("Unexpected token: "+JSON.stringify(e.peek()))}))}function l(){return c((function(){return i(v(),0)}))}}